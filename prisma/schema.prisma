// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserType {
  USER
  PARTNER
  ADMIN
  EMPLOYEE
}

enum UserStatus {
  active
  inactive
}

enum LeadStage {
  New
  Qualified
  Proposal
  Closed
}

enum ClosedReason {
  Won
  Lost
  Lost_Unqualified
}

enum LeadSource {
  Website
  Referral
  Social_Media
  Advertisement
  Cold_Call
  Other
}

enum LeadSubSource {
  Facebook_Ads
  Google_Ads
  LinkedIn
  Instagram
  Word_of_Mouth
  Email_Campaign
  Other
}

enum OrderStatus {
  Submitted
  Confirmed
  Assigned
  InProgress
  Review
  Delivered
  Closed
  Cancelled
}

enum PaymentMethod {
  bKash
  Card
  Cash
}

enum PaymentStatus {
  Pending
  Paid
  Refunded
  Failed
}

model User {
  id                    String        @id @default(uuid())
  name                  String?
  email                 String?       @unique
  emailVerified         DateTime?
  phone                 String?       @unique
  phoneVerified         DateTime?
  password              String?
  type                  UserType      @default(USER)
  status                UserStatus    @default(active)
  image                 String?
  address               String?
  district              String?
  serviceCategories     String[]      @default([])
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  accounts              Account[]
  sessions              Session[]
  modifiedCategories    Category[]    @relation("CategoryLastModifiedBy")
  modifiedSubCategories SubCategory[] @relation("SubCategoryLastModifiedBy")
  modifiedServices      Service[]     @relation("ServiceLastModifiedBy")
  customerOrders        Order[]       @relation("CustomerOrders")
  vendorOrders          Order[]       @relation("VendorOrders")
  assignedOrders        Order[]       @relation("AssignedOrders")
  reviews               Review[]

  @@map("users")
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Lead {
  id                String         @id @default(uuid())
  clientName        String
  whatsapp          String?
  mobile            String?
  facebook          String?
  email             String?
  profession        String?
  street            String?
  city              String?
  thana             String?
  district          String?
  country           String?        @default("Bangladesh")
  postalCode        String?
  desiredService    String?
  initialDiscussion String?
  stage             LeadStage      @default(New)
  closedReason      ClosedReason?
  closedReasonText  String?
  leadSource        LeadSource
  leadSubSource     LeadSubSource?
  leadOwner         String
  comment           String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  @@map("leads")
}

model Category {
  id               String        @id @default(uuid())
  serialNumber     Int?          @unique
  title            String        @unique
  icon             String?
  status           String        @default("active") // active, inactive
  lastModifiedById String?
  lastModifiedBy   User?         @relation("CategoryLastModifiedBy", fields: [lastModifiedById], references: [id])
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  subCategories    SubCategory[]
  services         Service[]     @relation("ServiceCategory")

  @@map("categories")
}

model SubCategory {
  id               String    @id @default(uuid())
  serialNumber     Int?      @unique
  title            String
  icon             String?
  categoryId       String
  category         Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  status           String    @default("active") // active, inactive
  lastModifiedById String?
  lastModifiedBy   User?     @relation("SubCategoryLastModifiedBy", fields: [lastModifiedById], references: [id])
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  services         Service[] @relation("ServiceSubCategory")

  @@unique([title, categoryId])
  @@map("sub_categories")
}

model Service {
  id            String       @id @default(uuid())
  title         String
  slug          String       @unique
  image         String?
  rating        String?      @default("0")
  description   String?      @db.Text
  deliveryTime  String?
  startingPrice String?
  categoryId    String
  category      Category     @relation("ServiceCategory", fields: [categoryId], references: [id], onDelete: Cascade)
  subCategoryId String?
  subCategory   SubCategory? @relation("ServiceSubCategory", fields: [subCategoryId], references: [id], onDelete: SetNull)
  status        String       @default("active") // active, inactive

  // Overview fields
  shortDescription    String?  @db.Text
  detailedDescription String?  @db.Text // acts, laws, orders, rules, with years
  providerAuthority   String? // court/council (who provides the service)
  infoSource          String?  @db.Text // where the service information comes from (for Info Source section)
  requiredDocuments   String[] @default([]) // needed from the client
  whatsIncluded       String?  @db.Text // what will we do
  whatsNotIncluded    String?  @db.Text // what must be done externally
  timeline            String? // approximate
  additionalNotes     String?  @db.Text // comments

  // Learning and Discussion
  processFlow String? @db.Text
  videoUrl    String? // TBA

  // FAQ
  faqs Json? // array of {question: string, answer: string}

  // Consultants
  consultantQualifications String? @db.Text

  // Price Packages
  packages Json? // array of {name: string, price: string, features: string[], description?: string}

  // Core cost breakdown (for snaplegal)
  coreFiling   String?
  coreStamps   String?
  coreCourtFee String?

  // Presented cost breakdown (for the client)
  clientFiling        String?
  clientStamps        String?
  clientCourtFee      String?
  clientConsultantFee String?

  lastModifiedById String?
  lastModifiedBy   User?       @relation("ServiceLastModifiedBy", fields: [lastModifiedById], references: [id])
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  orderItems       OrderItem[]
  reviews          Review[]

  @@map("services")
}

model Order {
  id             String        @id @default(uuid())
  orderNumber    String        @unique
  customerId     String
  customer       User          @relation("CustomerOrders", fields: [customerId], references: [id], onDelete: Cascade)
  vendorId       String?
  vendor         User?         @relation("VendorOrders", fields: [vendorId], references: [id], onDelete: SetNull)
  assignedToId   String?
  assignedTo     User?         @relation("AssignedOrders", fields: [assignedToId], references: [id], onDelete: SetNull)
  status         OrderStatus   @default(Submitted)
  paymentMethod  PaymentMethod
  paymentStatus  PaymentStatus @default(Pending)
  subtotal       Float
  additionalCost Float         @default(0)
  deliveryCharge Float         @default(0)
  discount       Float         @default(0)
  total          Float
  scheduledDate  DateTime?
  scheduledTime  String?
  address        String?
  notes          String?       @db.Text
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  items          OrderItem[]

  @@map("orders")
}

model OrderItem {
  id            String   @id @default(uuid())
  orderId       String
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  serviceId     String?
  service       Service? @relation(fields: [serviceId], references: [id], onDelete: SetNull)
  serviceName   String
  quantity      Int      @default(1)
  price         Float
  originalPrice Float?
  details       String?  @db.Text
  createdAt     DateTime @default(now())

  @@map("order_items")
}

model Review {
  id              String   @id @default(uuid())
  serviceId       String
  service         Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  userId          String?
  user            User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  orderId         String?  // Link to order if available (verified purchase)
  reviewType      String   @default("service") // "service" or "consultant"
  rating          Int      // 1-5
  comment         String?  @db.Text
  reviewerName    String   // Name of reviewer (can be from user or custom)
  images          String[] @default([]) // URLs
  helpfulCount    Int      @default(0)
  isVerified      Boolean  @default(false) // Verified purchase
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("reviews")
}
