generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DIRECT_URL")
}

model User {
  id                    String        @id @default(uuid())
  name                  String?
  email                 String?       @unique
  emailVerified         DateTime?
  phone                 String?       @unique
  phoneVerified         DateTime?
  password              String?
  type                  UserType      @default(USER)
  image                 String?
  address               String?
  district              String?
  serviceCategories     String[]      @default([])
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  status                UserStatus    @default(active)
  accounts              Account[]
  modifiedCategories    Category[]    @relation("CategoryLastModifiedBy")
  assignedOrders        Order[]       @relation("AssignedOrders")
  customerOrders        Order[]       @relation("CustomerOrders")
  vendorOrders          Order[]       @relation("VendorOrders")
  reviews               Review[]
  modifiedServices      Service[]     @relation("ServiceLastModifiedBy")
  sessions              Session[]
  modifiedSubCategories SubCategory[] @relation("SubCategoryLastModifiedBy")

  @@map("users")
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Lead {
  id                String         @id @default(uuid())
  clientName        String
  whatsapp          String?
  mobile            String?
  facebook          String?
  email             String?
  profession        String?
  street            String?
  city              String?
  thana             String?
  district          String?
  country           String?        @default("Bangladesh")
  postalCode        String?
  desiredService    String?
  initialDiscussion String?
  stage             LeadStage      @default(New)
  closedReason      ClosedReason?
  closedReasonText  String?
  leadSource        LeadSource
  leadSubSource     LeadSubSource?
  leadOwner         String
  comment           String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  @@map("leads")
}

model Category {
  id               String            @id @default(uuid())
  title            String            @unique
  icon             String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  serialNumber     Int?
  status           String            @default("active")
  lastModifiedById String?
  lastModifiedBy   User?             @relation("CategoryLastModifiedBy", fields: [lastModifiedById], references: [id])
  homepageSections HomepageSection[]
  services         Service[]         @relation("ServiceCategory")
  subCategories    SubCategory[]

  @@map("categories")
}

model SubCategory {
  id               String    @id @default(uuid())
  serialNumber     Int?
  title            String
  icon             String?
  categoryId       String
  status           String    @default("active")
  lastModifiedById String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  services         Service[] @relation("ServiceSubCategory")
  category         Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  lastModifiedBy   User?     @relation("SubCategoryLastModifiedBy", fields: [lastModifiedById], references: [id])

  @@unique([title, categoryId])
  @@map("sub_categories")
}

model Service {
  id                       String       @id @default(uuid())
  title                    String
  slug                     String       @unique
  serialNumber             Int?
  image                    String?
  rating                   String?      @default("0")
  description              String?
  deliveryTime             String?
  startingPrice            String?
  discountType             String?      // 'amount' | 'percentage'
  discountValue            String?     // e.g. "500" for à§³500 off, "10" for 10% off
  categoryId               String
  subCategoryId            String?
  status                   String       @default("active")
  shortDescription         String?
  detailedDescription      String?
  providerAuthority        String?
  requiredDocuments        String[]     @default([])
  keywords                 String[]     @default([])
  whatsIncluded            String?
  whatsNotIncluded         String?
  timeline                 String?
  additionalNotes          String?
  processFlow              String?
  videoUrl                 String?
  faqs                     Json?
  consultantQualifications String?
  packages                 Json?
  coreFiling               String?
  coreStamps               String?
  coreCourtFee             String?
  clientFiling             String?
  clientStamps             String?
  clientCourtFee           String?
  clientConsultantFee      String?
  lastModifiedById         String?
  createdAt                DateTime     @default(now())
  updatedAt                DateTime     @updatedAt
  infoSource               String?
  whyChooseConsultants     Json?
  howWeSelectConsultants   Json?
  communityDiscussions     Json?
  orderItems               OrderItem[]
  reviews                  Review[]
  category                 Category     @relation("ServiceCategory", fields: [categoryId], references: [id], onDelete: Cascade)
  lastModifiedBy           User?        @relation("ServiceLastModifiedBy", fields: [lastModifiedById], references: [id])
  subCategory              SubCategory? @relation("ServiceSubCategory", fields: [subCategoryId], references: [id])

  @@map("services")
}

model Order {
  id             String        @id @default(uuid())
  orderNumber    String        @unique
  customerId     String
  vendorId       String?
  assignedToId   String?
  status         OrderStatus   @default(Submitted)
  paymentMethod  PaymentMethod
  paymentStatus  PaymentStatus @default(Pending)
  subtotal       Float
  additionalCost Float         @default(0)
  deliveryCharge Float         @default(0)
  discount       Float         @default(0)
  total          Float
  scheduledDate  DateTime?
  scheduledTime  String?
  address        String?
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  items          OrderItem[]
  assignedTo     User?         @relation("AssignedOrders", fields: [assignedToId], references: [id])
  customer       User          @relation("CustomerOrders", fields: [customerId], references: [id], onDelete: Cascade)
  vendor         User?         @relation("VendorOrders", fields: [vendorId], references: [id])

  @@map("orders")
}

model OrderItem {
  id            String   @id @default(uuid())
  orderId       String
  serviceId     String?
  serviceName   String
  quantity      Int      @default(1)
  price         Float
  originalPrice Float?
  details       String?
  createdAt     DateTime @default(now())
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  service       Service? @relation(fields: [serviceId], references: [id])

  @@map("order_items")
}

model Review {
  id           String   @id @default(uuid())
  serviceId    String
  userId       String?
  orderId      String?
  reviewType   String   @default("service")
  rating       Int
  comment      String?
  reviewerName String
  images       String[] @default([])
  helpfulCount Int      @default(0)
  isVerified   Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  service      Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  user         User?    @relation(fields: [userId], references: [id])

  @@map("reviews")
}

model HomepageSection {
  id         String    @id @default(uuid())
  type       String
  categoryId String?
  serviceIds String[]  @default([])
  sortOrder  Int       @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  category   Category? @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@map("homepage_sections")
}

enum UserType {
  USER
  PARTNER
  ADMIN
  EMPLOYEE
}

enum UserStatus {
  active
  inactive
}

enum LeadStage {
  New
  Qualified
  Proposal
  Closed
}

enum ClosedReason {
  Won
  Lost
  Lost_Unqualified
}

enum LeadSource {
  Website
  Referral
  Social_Media
  Advertisement
  Cold_Call
  Other
}

enum LeadSubSource {
  Facebook_Ads
  Google_Ads
  LinkedIn
  Instagram
  Word_of_Mouth
  Email_Campaign
  Other
}

enum OrderStatus {
  Submitted
  Confirmed
  Assigned
  InProgress
  Review
  Delivered
  Closed
  Cancelled
}

enum PaymentMethod {
  bKash
  Card
  Cash
}

enum PaymentStatus {
  Pending
  Paid
  Refunded
  Failed
}
